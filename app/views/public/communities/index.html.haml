= render 'layouts/header_menu'

.community-index-head-title
  %h2 ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ä¸€è¦§
  = link_to "ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ä½œæˆ", new_public_community_path, data: { 'turbolinks': false }, class: "btn btn-info community-index-create-btn"
.communities-kaminari
  = paginate @communities
.community-toc
  .community-toc-title ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ç›®æ¬¡
  %ul
    - @communities.each do |community|
      %li
        ğŸµ
        = link_to community.name, "#community-#{community.id}", class: "text-decoration-none"

.community-index-container
  - @communities.each do |community|
    - @owner = Customer.find_by(id: community.owner_id)
    .card.mb-5{id: "community-#{community.id}"}
      = link_to public_community_path(community), data: { 'turbolinks': false } do
        .img-container
          - if community.community_image.present?
            = image_tag community.community_image
          - else
            = image_tag 'no_image'
      .card-body.text-container
        %h5.card-title
          = link_to community.name, public_community_path(community), data: { 'turbolinks': false }
        %h6.card-subtitle
          å‚åŠ äººæ•°
          = community.customers.count.to_s + "äºº"
          %hr
          [ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚ªãƒ¼ãƒŠãƒ¼]
          %br
          .community-owner-img
            = link_to public_customer_path(@owner), data: { 'turbolinks': false } do
              - if @owner.profile_image.present?
                = image_tag @owner.profile_image
              - else
                = image_tag 'no_image'
              .owner-name
                = @owner.name
        %hr
        .community-show-link-area
          = link_to "ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£è©³ç´°ã¸", public_community_path(community), class: "btn-info community-show-link", data: { 'turbolinks': false }
        %hr
        .community-action-btn
          - if community.owner_id == current_customer.id
            = link_to 'ç·¨é›†ã™ã‚‹', edit_public_community_path(community), data: { 'turbolinks': false }, class: "btn btn-success"
          - elsif community.customers.include?(current_customer)
            = link_to 'ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚’é€€ä¼š', public_community_leave_path(community), method: :delete, class: "btn btn-danger", data: { confirm: 'ã“ã¡ã‚‰ã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚’æŠœã‘ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ' }
          - elsif community.permits.exists?(customer_id: current_customer.id)
            = link_to 'å‚åŠ ç”³è«‹ã®å–æ¶ˆ', public_community_permits_path(community), method: :delete, class: "btn btn-danger", data: { 'turbolinks': false, confirm: 'ã“ã¡ã‚‰ã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®å‚åŠ ç”³è«‹ã‚’å–æ¶ˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ' }
          - else
            = link_to 'å‚åŠ ã‚’ç”³è«‹ã™ã‚‹', public_community_permits_path(community), method: :post, class: "btn btn-success", data: { 'turbolinks': false, confirm: 'ã“ã¡ã‚‰ã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«å‚åŠ ç”³è«‹ã‚’ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ' }
        %hr
        %p.card-text
          [æ´»å‹•å ´æ‰€]
          = community.prefecture.name if community.prefecture.present?
          %hr
          [æ´»å‹•ãƒšãƒ¼ã‚¹]
          = community.human_attribute_enum(:activity_stance)
