= render 'layouts/header_menu'

.event-show-title
  %h2 ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°
  .event-show-follow
    - if @owner == current_customer
      = link_to 'ç·¨é›†ã™ã‚‹', edit_public_event_path(@event), data: { 'turbolinks': false }, class: "btn btn-sm btn-success event-show-btn"
      = link_to 'ã‚¤ãƒ™ãƒ³ãƒˆå‰Šé™¤', public_event_path(@event), method: :delete, data: { 'turbolinks': false, confirm: 'ã“ã¡ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ' }, class: "btn btn-sm btn-danger event-show-btn"
      = link_to 'å‚åŠ ã™ã‚‹ğŸµ', '#event-songs', data: { 'turbolinks': false }, class: "btn btn-sm btn-info event-show-btn"
    - else
      = link_to 'å‚åŠ ã™ã‚‹ğŸµ', '#event-songs', data: { 'turbolinks': false }, class: "btn btn-sm btn-info event-show-btn"

.event-show-container.px-0.px-sm-0
  .row
    .col-md-3
      .event-show-card
        .card
          .img-container
            - if @event.event_image.present?
              = image_tag @event.event_image
            - else
              = image_tag 'no_image'
          .card-body.text-container
            %h5.card-title
              = @event.event_name
            %hr
            %h6.card-subtitle
              [ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆè€…]
              %br
              .event-owner-img
                = link_to public_customer_path(@owner), data: { 'turbolinks': false } do
                  - if @owner.profile_image.present?
                    = image_tag @owner.profile_image
                  - else
                    = image_tag 'no_image'
                  .owner-name
                    = @owner.name
            %hr
            %p.card-text
            - if @owner == current_customer
              .dropdown
                %button#dropdownMenuButton.btn.btn-secondary.dropdown-toggle{"aria-expanded" => "false", "aria-haspopup" => "true", "data-toggle" => "dropdown", type: "button"}
                  ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆè€…å°‚ç”¨
                .dropdown-menu{"aria-labelledby" => "dropdownMenuButton"}
                  = link_to 'ç·¨é›†ã™ã‚‹', edit_public_event_path(@event), data: { 'turbolinks': false }, class: "dropdown-item btn btn-sm btn-success community-show-btn text-secondary bg-transparent"
                  = link_to 'ã‚¤ãƒ™ãƒ³ãƒˆå‰Šé™¤', public_event_path(@event), method: :delete, data: { 'turbolinks': false, confirm: 'ã“ã¡ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ' }, class: "dropdown-item btn btn-sm btn-danger community-show-btn text-secondary bg-transparent"
                  = link_to 'å‚åŠ ã™ã‚‹ğŸµ', '#event-songs', class: "dropdown-item btn btn-sm btn-success community-show-btn text-secondary bg-transparent"
            - else
              = link_to 'å‚åŠ ã™ã‚‹ğŸµ', '#event-songs', class: "btn btn-sm btn-success event-show-btn"

    .col-md-9
      %table.table.table-striped.event-show-table{:width=>"100%",:border=>"1"}
        %colgroup
          %col{width: "19%"}
          %col{width: "81%"}
            %tr
              %th{scope:"row"} é–‹å‚¬ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£
              %td
                = @community.name
                .text-red
                  â€»ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ã€#{@community.name}ã€‘ã«å‚åŠ ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
            %tr
              %th{scope:"row"} ã‚¤ãƒ™ãƒ³ãƒˆå
              %td
                = @event.event_name
            %tr
              %th{scope:"row"} å‚åŠ äººæ•°
              %td
                #{@joined_member_counts}äºº
            %tr
              %th{scope:"row"} é–‹å§‹æ™‚é–“
              %td
                = l @event.event_start_time, format: :short
            %tr
              %th{scope:"row"} çµ‚äº†æ™‚é–“
              %td
                = l @event.event_end_time, format: :short
            %tr
              %th{scope:"row"} å‚åŠ è²»ç”¨
              %td
                = @event.entrance_fee.to_s(:delimited) + "å††"
            %tr
              %th{scope:"row"} é–‹å‚¬å ´æ‰€
              %td
                = @event.place
            %tr
              %th{scope:"row"} é–‹å‚¬å ´æ‰€ï¼ˆåœ°å›³ï¼‰
              %td
                #map
            %tr
              %th{scope:"row"} æ¥½æ›²
              %td
                - @event.songs.each.with_index(1) do |song, i|
                  .song-name
                    ã€#{i}æ›²ç›®ã€‘
                    = song.song_name
                    %br
                  - if song.youtube_url.present?
                    %iframe{
                      src: "https://www.youtube.com/embed/#{song.youtube_url[32..42]}",
                      allow: "accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",
                      allowfullscreen: "",
                      frameborder: "0",
                      height: "315",
                      width: "90%"
                    }
                  - else
                    æŠ•ç¨¿ã•ã‚ŒãŸå‹•ç”»ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
                  %br
                  .join-member
                    #{song.song_name} ğŸ¤ãƒœãƒ¼ã‚«ãƒ«ğŸ¤
                    %br
                    .member
                      - song.customers.distinct.each do |customer|
                        -if customer.parts.pluck(:name).include?("ãƒœãƒ¼ã‚«ãƒ«")
                          = link_to public_customer_path(customer), class: 'image-style', data: { 'turbolinks': false } do
                            .image_container
                              - if customer.profile_image.present?
                                = image_tag customer.profile_image, class: "icon_mini"
                              - else
                                = image_tag 'no_image', class: "icon_mini"
                            = customer.name
                          - @vocal << customer.id
                      %hr
                      .part-join-member
                        ãƒœãƒ¼ã‚«ãƒ«#{@vocal.length}äºº
                      - @vocal = []
                    %hr
                    #{song.song_name} ğŸ¸ã‚®ã‚¿ãƒ¼ğŸ¸
                    %br
                    .member
                      - song.customers.distinct.each do |customer|
                        - if customer.parts.pluck(:name).include?("ã‚®ã‚¿ãƒ¼")
                          = link_to public_customer_path(customer), class: 'image-style', data: { 'turbolinks': false } do
                            .image_container
                              - if customer.profile_image.present?
                                = image_tag customer.profile_image, class: "icon_mini"
                              - else
                                = image_tag 'no_image', class: "icon_mini"
                            = customer.name
                          - @guitar << customer.id
                      %hr
                      .part-join-member
                        ã‚®ã‚¿ãƒ¼#{@guitar.length}äºº
                      - @guitar = []
                    %hr
                    #{song.song_name} ğŸ¸ãƒ™ãƒ¼ã‚¹ğŸ¸
                    %br
                    .member
                      - song.customers.distinct.each do |customer|
                        - if customer.parts.pluck(:name).include?("ãƒ™ãƒ¼ã‚¹")
                          = link_to public_customer_path(customer), class: 'image-style', data: { 'turbolinks': false } do
                            .image_container
                              - if customer.profile_image.present?
                                = image_tag customer.profile_image, class: "icon_mini"
                              - else
                                = image_tag 'no_image', class: "icon_mini"
                            = customer.name
                          - @bass << customer.id
                      %hr
                      .part-join-member
                        ãƒ™ãƒ¼ã‚¹#{@bass.length}äºº
                      - @bass = []
                    %hr
                    #{song.song_name} ğŸ¹ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ğŸ¹
                    %br
                    .member
                      - song.customers.distinct.each do |customer|
                        - if customer.parts.pluck(:name).include?("ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰")
                          = link_to public_customer_path(customer), class: 'image-style', data: { 'turbolinks': false } do
                            .image_container
                              - if customer.profile_image.present?
                                = image_tag customer.profile_image, class: "icon_mini"
                              - else
                                = image_tag 'no_image', class: "icon_mini"
                            = customer.name
                          - @keyboard << customer.id
                      %hr
                      .part-join-member
                        ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰#{@keyboard.length}äºº
                      - @keyboard = []
                    %hr
                    #{song.song_name} ğŸ¥ãƒ‰ãƒ©ãƒ ğŸ¥
                    %br
                    .member
                      - song.customers.distinct.each do |customer|
                        - if customer.parts.pluck(:name).include?("ãƒ‰ãƒ©ãƒ ")
                          = link_to public_customer_path(customer), class: 'image-style', data: { 'turbolinks': false } do
                            .image_container
                              - if customer.profile_image.present?
                                = image_tag customer.profile_image, class: "icon_mini"
                              - else
                                = image_tag 'no_image', class: "icon_mini"
                            = customer.name
                          - @drums << customer.id
                      %hr
                      .part-join-member
                        ãƒ‰ãƒ©ãƒ #{@drums.length}äºº
                      - @drums = []
                    %hr
                    #{song.song_name} ğŸ·ç‰¹åˆ¥æ ğŸ·
                    %br
                    .member
                      - song.customers.distinct.each do |customer|
                        - part = customer.parts.pluck(:name)
                        - unless part.include?("ãƒœãƒ¼ã‚«ãƒ«") || part.include?("ã‚®ã‚¿ãƒ¼") || part.include?("ãƒ™ãƒ¼ã‚¹") || part.include?("ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰")  || part.include?("ãƒ‰ãƒ©ãƒ ")
                          = link_to public_customer_path(customer), class: 'image-style', data: { 'turbolinks': false } do
                            .image_container
                              - if customer.profile_image.present?
                                = image_tag customer.profile_image, class: "icon_mini"
                              - else
                                = image_tag 'no_image', class: "icon_mini"
                            = customer.name
                          - @others << customer.id
                      %hr
                      .part-join-member
                        ç‰¹åˆ¥æ #{@others.length}äºº
                      - @others = []
                  %hr
              %br
            %tr
              %th{scope:"row"} å‚åŠ ãƒ•ã‚©ãƒ¼ãƒ 
              %td
                #event-songs
                  -if @event.event_end_time > Time.now
                    ğŸ“¢å‚åŠ ã—ãŸã„æ›²ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ã€Œå‚åŠ ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ä¸‹ã•ã„ğŸ“¢
                    %br
                    ğŸ“¢å‚åŠ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚ŒãŸæ¥½æ›²ã«ã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ğŸ“¢
                    .text-red
                      â€»ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ã€#{@community.name}ã€‘ã«å‚åŠ ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
                    %hr
                    = form_tag(public_event_join_path(@event), method: :get,  onSubmit: "return CheckJoin()") do
                      = collection_check_boxes(:event, :song_ids, @event.songs, :id, :song_name, checked:false) do |event|
                        = event.label do
                          = event.check_box
                          â—€ï¸å‚åŠ ã—ãŸã„æ›²ã«ãƒã‚§ãƒƒã‚¯ğŸµ
                          .song-name
                            = event.text
                          %hr
                        %br
                        = hidden_field_tag :event_id, @event.id
                      %input{type: "submit", value: "å‚åŠ ã™ã‚‹", confirm: "ã“ã¡ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã«å‚åŠ ã‚’ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ", data: {'disable_with': 'é€ä¿¡ä¸­...', 'turbolinks': false}}
                  - else
                    ã“ã¡ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯çµ‚äº†è‡´ã—ã¾ã—ãŸã€‚
            %tr
              %th{scope:"row"} ã‚¤ãƒ™ãƒ³ãƒˆè£œè¶³
              %td
                = simple_format(@event.introduction)

- latitude = @latitude
- longitude = @longitude
- address = @address

%div{type: "text/javascript"}
  :javascript
    function initMap() {
      var test = {lat: #{latitude}, lng: #{longitude}};
      var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 15, 
                center: test
                });
      var transitLayer = new google.maps.TransitLayer();
      transitLayer.setMap(map);

      var contentString = "ä½æ‰€ï¼š #{address}";
      var infowindow = new google.maps.InfoWindow({
        content: contentString
      });

      var marker = new google.maps.Marker({
                    position:test,
                    map: map,
                    title: contentString
                    });

      marker.addListener('click', function() {
        infowindow.open(map, marker);
      });
    }
%script{async: "", defer: "defer", src: "https://maps.googleapis.com/maps/api/js?key=#{Rails.application.credentials.map_api_key}&callback=initMap"}
 