= render 'layouts/header_menu'
.event-show
  .event-show-title
    %h2 ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°
    .event-show-follow
      - if @owner == current_customer
        = link_to 'ç·¨é›†ã™ã‚‹', edit_public_event_path(@event, community_id: @event.community_id), data: { 'turbolinks': false }, class: "btn btn-sm btn-success event-show-btn"
        = link_to 'ã‚¤ãƒ™ãƒ³ãƒˆå‰Šé™¤', public_event_path(@event), method: :delete, data: { 'turbolinks': false, confirm: 'ã“ã¡ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ' }, class: "btn btn-sm btn-danger event-show-btn"
        = link_to 'å‚åŠ ã™ã‚‹ğŸµ', '#event-songs', data: { 'turbolinks': false }, class: "btn btn-sm btn-info event-show-btn"
      - else
        = link_to 'å‚åŠ ã™ã‚‹ğŸµ', '#event-songs', data: { 'turbolinks': false }, class: "btn btn-sm btn-info event-show-btn"

  .event-show-container.px-0.px-sm-0
    .row
      .col-md-3
        .event-show-card
          .card
            .img-container
              - if @event.event_image.present?
                = image_tag @event.event_image
              - else
                = image_tag 'no_image'
            .card-body.text-container
              %h5.card-title
                = @event.event_name
              %hr
              %h6.card-subtitle
                [ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆè€…]
                %br
                .event-owner-img
                  = link_to public_customer_path(@owner), data: { 'turbolinks': false } do
                    - if @owner.profile_image.present?
                      = image_tag @owner.profile_image
                    - else
                      = image_tag 'no_image'
                    .owner-name
                      = @owner.name
              %hr
              %p.card-text
              - if @owner == current_customer
                .dropdown
                  %button#dropdownMenuButton.btn.btn-secondary.dropdown-toggle{"aria-expanded" => "false", "aria-haspopup" => "true", "data-toggle" => "dropdown", type: "button"}
                    ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆè€…å°‚ç”¨
                  .dropdown-menu{"aria-labelledby" => "dropdownMenuButton"}
                    = link_to 'ç·¨é›†ã™ã‚‹', edit_public_event_path(@event), data: { 'turbolinks': false }, class: "dropdown-item btn btn-sm btn-success community-show-btn text-secondary bg-transparent"
                    = link_to 'ã‚¤ãƒ™ãƒ³ãƒˆå‰Šé™¤', public_event_path(@event), method: :delete, data: { 'turbolinks': false, confirm: 'ã“ã¡ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ' }, class: "dropdown-item btn btn-sm btn-danger community-show-btn text-secondary bg-transparent"
                    = link_to 'å‚åŠ ã™ã‚‹ğŸµ', '#event-songs', class: "dropdown-item btn btn-sm btn-success community-show-btn text-secondary bg-transparent"
              - else
                = link_to 'å‚åŠ ã™ã‚‹ğŸµ', '#event-songs', class: "btn btn-sm btn-success event-show-btn"

      .col-md-9
        %table.table.table-striped.event-show-table{:width=>"90%",:border=>"1"}
          %colgroup
            %col{width: "19%"}
            %col{width: "81%"}
              %tr
                %th{scope:"row"} é–‹å‚¬ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£
                %td
                  = @community.name
                  .text-red
                    â€»ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ã€#{@community.name}ã€‘ã«å‚åŠ ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
              %tr
                %th{scope:"row"} ã‚¤ãƒ™ãƒ³ãƒˆå
                %td
                  = @event.event_name
              %tr
                %th{scope:"row"} æœ€çµ‚æ›´æ–°æ—¥
                %td
                  = l @event.updated_at, format: :short
                  (
                  = time_ago_in_words(@event.updated_at) + "å‰"
                  )
              - if @event.url.present?
                %tr
                  %th{scope:"row"} å‚è€ƒURL
                  %td
                    .event-url
                      - text = @event.url
                      = link_to text, @event.url, target: :_blank, rel: "noopener noreferrer", data: { 'turbolinks': false }
                      %hr
                      = @event.url_comment
              %tr
                %th{scope:"row"} å‚åŠ äººæ•°
                %td
                  #{@joined_member_counts}äºº
              - if @join_members.present?
                %tr 
                  %th{scope:"row"} å‚åŠ ãƒ¡ãƒ³ãƒãƒ¼
                  %td
                    .join-member-list
                      - @join_members.each do |customer|
                        = link_to public_customer_path(customer), class: 'image-style', data: { 'turbolinks': false } do
                          - if customer.profile_image.present?
                            = image_tag customer.profile_image, class: "icon_mini"
                          - else
                            = image_tag 'no_image', class: "icon_mini"
                          = customer.name
                        %br
                        %hr
              %tr
                %th{scope:"row"} æˆç«‹æ¥½æ›²æ•°
                %td
                  %h4.text-red
                    #{@complete_count}æ›² æˆç«‹!!
                  (å…¨#{@event.songs.length}æ›²)
              - if @complete_songs.present?
                %tr
                  %th{scope:"row"} æˆç«‹æ¥½æ›²
                  %td
                    .complete.complete-songs-list
                      - @complete_songs.each.with_index(1) do |song, i|
                        ã€#{i}ã€‘
                        = song.song_name
                        = link_to "è©³ç´°", "#selected-#{song.id}", data: { 'turbolinks': false }, class: "btn btn-sm btn-info ml-2 ump-to-songs-btn"
                        %br
                        %hr
              - if @recruiting_songs.present?
                %tr
                  %th{scope:"row"} å‹Ÿé›†ä¸­æ¥½æ›²
                  %td
                    .recruiting.recruiting-songs-list
                      - @recruiting_songs.each.with_index(1) do |song, i|
                        ã€#{i}ã€‘
                        = song.song_name
                        = link_to "è©³ç´°", "#selected-#{song.id}", data: { 'turbolinks': false }, class: "btn btn-sm btn-info ml-2 jump-to-songs-btn"
                        %br
                        %hr
              %tr
                %th{scope:"row"} é–‹å§‹æ™‚é–“
                %td
                  = l @event.event_start_time, format: :short
              %tr
                %th{scope:"row"} çµ‚äº†æ™‚é–“
                %td
                  = l @event.event_end_time, format: :short
              %tr
                %th{scope:"row"} å‚åŠ è²»ç”¨
                %td
                  = @event.entrance_fee.to_s(:delimited) + "å††"
              %tr
                %th{scope:"row"} é–‹å‚¬å ´æ‰€
                %td
                  = @event.place
              %tr
                %th{scope:"row"} é–‹å‚¬å ´æ‰€ï¼ˆåœ°å›³ï¼‰
                %td
                  #map
              %tr
                %th{scope:"row"} æ¥½æ›²
                %td
                  ğŸ“¢ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§å…¨æ¥½æ›²ãŒç¢ºèªã§ãã¾ã™
                  .event-songs-list
                    - @event.songs.each.with_index(1) do |song, i|
                      %div{id: "selected-#{song.id}"}
                        - if song.join_parts.map{|join_part| join_part.customers.length }.include?(0)
                          .recruiting
                            %h2.recruiting-caption
                              ãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†ä¸­!!
                            = render "song_info", song: song, i: i
                        - else
                          .complete
                            %h2.complete-caption
                              æ¥½æ›²æˆç«‹ğŸµ
                            = render "song_info", song: song, i: i
              %tr
                %th{scope:"row"} å‚åŠ ãƒ•ã‚©ãƒ¼ãƒ 
                %td
                  #event-songs
                    -if @event.event_end_time > Time.now
                      ğŸ“¢å‚åŠ ã—ãŸã„æ›²ã®ãƒ‘ãƒ¼ãƒˆï¼ˆå…¨ã¦ï¼‰ã‚’é¸ã‚“ã§ä¸‹éƒ¨ã®ã€å‚åŠ ã™ã‚‹ã€‘ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ä¸‹ã•ã„
                      %br
                      ğŸ“¢å‚åŠ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ä¸Šè¨˜ã€æ¥½æ›²ã€‘ã®ãƒ‘ãƒ¼ãƒˆå†…ã«ã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                      %br
                      .text-red
                        â€»ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ã€#{@community.name}ã€‘ã«å‚åŠ ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
                      %hr
                      ğŸ“¢ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§å…¨æ¥½æ›²ãŒç¢ºèªã§ãã¾ã™
                      %br
                      = form_tag(public_event_join_path(@event), method: :post,  onSubmit: "return CheckJoin()") do
                        .event-songs-join-form
                          - @event.songs.each do |song|
                            %div{id: "support-join-#{song.id}"}
                              .join-part-list
                                .join-part-song-name
                                  =song.song_name
                                %hr
                                  = collection_check_boxes(:event, :join_part_ids, song.join_parts, :id, :join_part_name, checked:false) do |part|
                                    = part.label do
                                      .song-name
                                        = part.check_box
                                        = part.text
                                      â˜ï¸å‚åŠ ã—ãŸã„ãƒ‘ãƒ¼ãƒˆã«ãƒã‚§ãƒƒã‚¯
                                      %hr
                                    %br
                                    = hidden_field_tag :event_id, @event.id
                        %input{type: "submit", value: "å‚åŠ ã™ã‚‹", class: "join-part-btn", confirm: "ã“ã¡ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã«å‚åŠ ã‚’ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ", data: {'disable_with': 'é€ä¿¡ä¸­...', 'turbolinks': false}}
                    - else
                      ã“ã¡ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯çµ‚äº†è‡´ã—ã¾ã—ãŸã€‚
              %tr
                %th{scope:"row"} ã‚¤ãƒ™ãƒ³ãƒˆè£œè¶³
                %td
                  = simple_format(@event.introduction)
              - if @owner == current_customer
                %tr
                  %th{scope:"row"} CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                  %td
                    = link_to "å‚åŠ ä¸€è¦§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰", public_event_path(@event, format: :csv), data: { 'turbolinks': false }, class: "btn btn-sm btn-info event-show-btn"

  - latitude = @latitude
  - longitude = @longitude
  - address = @address

  %div{type: "text/javascript"}
    :javascript
      function initMap() {
        var test = {lat: #{latitude}, lng: #{longitude}};
        var map = new google.maps.Map(document.getElementById('map'), {
                  zoom: 15, 
                  center: test
                  });
        var transitLayer = new google.maps.TransitLayer();
        transitLayer.setMap(map);

        var contentString = "ä½æ‰€ï¼š #{address}";
        var infowindow = new google.maps.InfoWindow({
          content: contentString
        });

        var marker = new google.maps.Marker({
                      position:test,
                      map: map,
                      title: contentString
                      });

        marker.addListener('click', function() {
          infowindow.open(map, marker);
        });
      }
  %script{async: "", defer: "defer", src: "https://maps.googleapis.com/maps/api/js?key=#{Rails.application.credentials.map_api_key}&callback=initMap"}
  