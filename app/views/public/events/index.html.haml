= render 'layouts/header_menu'

.event-index-head-title
  %h2 ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§
.events-kaminari
  = paginate @events
- if @events.present?
  %nav.event-toc.d-sm-none
    %h4.event-toc-title ğŸ§­ ç›®æ¬¡
    %ul
      - @events.each_with_index do |event, index|
        %li
          ğŸ¸
          %a{href: "#event-#{index}"}= truncate(event.event_name, length: 20)

.event-index-container
  - if @events.present?
    - @events.each_with_index do |event, index|
      - @owner = Customer.find(event.customer.id)
      .card.mb-5{id: "event-#{index}"}
        .event-community-name
          = event.community.name
        - if event.event_end_time < Time.now
          .end-event
            ã‚¤ãƒ™ãƒ³ãƒˆçµ‚äº†
        - else
          .active-event
            å‚åŠ è€…å‹Ÿé›†ä¸­
        = link_to public_event_path(event), data: { 'turbolinks': false } do
          .img-container
            - if event.event_image.present?
              = image_tag event.event_image
            - else
              = image_tag 'no_image'
        .card-body.text-container
          %h5.card-title
            = link_to event.event_name, public_event_path(event), data: { 'turbolinks': false }
          %h6.card-subtitle
            <i class="fa-regular fa-clock"></i>
            %b é–‹å‚¬æ—¥(é–‹å§‹æ™‚é–“)
            %br
            = l event.event_start_time, format: :short
            %hr
            <i class="fa-solid fa-clock"></i>
            %b é–‹å‚¬æ—¥(çµ‚äº†æ™‚é–“)
            %br
            = l event.event_end_time, format: :short
            %hr
            <i class="fa-solid fa-clock-rotate-left"></i>
            %b å‚åŠ ç· åˆ‡æ—¥
            %br
            = l event.event_entry_deadline, format: :short
            %hr
            <i class="fa-solid fa-sack-dollar"></i>
            %b å‚åŠ è²»ç”¨
            %br
            = event.entrance_fee.to_s + "å††"
            %hr
            <i class="fa-solid fa-earth-asia"></i>
            %b é–‹å‚¬å ´æ‰€
            %br
            = event.place
            %hr
            <i class="fa-solid fa-people-group"></i>
            %b å‚åŠ äººæ•°
            :ruby
              joined_member_ids = []
              event.songs.each do |song|
                song.join_parts.each do |join_part|
                  joined_member_ids += join_part.customers.pluck(:id)
                end
              end
              joined_member_counts = joined_member_ids.uniq.length
            #{joined_member_counts}äºº
          %hr
          .event-show-link-area
            = link_to "ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ã¸", public_event_path(event), class: "btn btn-info event-show-link", data: { 'turbolinks': false }
          .event-action-btn
            - if @owner == current_customer
              %hr
              = link_to 'ç·¨é›†ã™ã‚‹', edit_public_event_path(event), data: { 'turbolinks': false }, class: "btn btn-success event-show-link"
          %p.card-text
            .center
              %hr
              [ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆè€…]
              %br
            .event-owner-img
              = link_to public_customer_path(@owner), data: { 'turbolinks': false } do
                - if @owner.profile_image.present?
                  = image_tag @owner.profile_image
                - else
                  = image_tag 'no_image'
                .owner-name
                  = @owner.name
  - else
    ã¾ã æŠ•ç¨¿è¨˜äº‹ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
